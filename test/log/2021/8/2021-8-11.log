select count(1) from
   (select distinct a.empno from agent_info a,staff_info b
      where
      (((c_rank_type='03' and mgrno=c_empno)
      or a.empno=c_empno)
      or ((c_rank_type='04' and chiefno=c_empno)
      or a.empno=c_empno))
      and ((a.end_date is null or a.end_date>p_sdate)
      and a.start_date<p_edate+1)
      and ((b.leave_reson_no not in('07','08','09','10','12')
      and b.leave_date>p_sdate)
      or b.leave_date is null)
      and b.empno=a.empno
      and substr(a.empno,1,4) not in('1EC0','1008')
      and b.emp_name<>'AUTOUNDW'
      union
      select distinct a.empno from agent_info a,staff_info b
      where (((c_rank_type='03' and mgrno=c_empno)
      or a.empno=c_empno)
      or ((c_rank_type='04' and chiefno=c_empno)
      or a.empno=c_empno))
      and ((a.end_date is null or a.end_date>p_sdate)
      and a.start_date<p_edate+1)
      and b.empno=a.empno
      and substr(a.empno,1,4)
      not in('1EC0','1008') and b.emp_name<>'AUTOUNDW'
      and b.leave_reson_no in('07','08','09','10','12')
      and b.leave_date>=add_months(p_sdate,1))