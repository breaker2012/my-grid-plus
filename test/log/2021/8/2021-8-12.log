(require
    '[org.gridgain.plus.dml.my-select :as my-select]
    '[org.gridgain.plus.dml.select-lexical :as my-lexical]
    '[org.gridgain.plus.context.my-context :as my-context]
    '[clojure.core.reducers :as r]
    '[clojure.string :as str]
    '[clojure.walk :as w])
(import (org.apache.ignite Ignite IgniteCache)
        (org.apache.ignite.internal IgnitionEx)
        (com.google.common.base Strings)
        (org.apache.ignite.configuration CacheConfiguration)
        (org.apache.ignite.cache CacheMode)
        (org.apache.ignite.cache.query FieldsQueryCursor SqlFieldsQuery)
        (org.gridgain.meta.cache MyContextCacheUtil)
        )

(def ignite (IgnitionEx/start "/Users/chenfei/Documents/Java/MyPlus/my-plus-deploy/src/main/resources/default-config.xml"))
=> nil
=> org.gridgain.meta.cache.MyContextCacheUtil
八月 12, 2021 11:34:13 下午 java.util.logging.LogManager$RootLogger log
警告: Failed to resolve default logging config file: config/java.util.logging.properties
[23:34:13]    __________  ________________
[23:34:13]   /  _/ ___/ |/ /  _/_  __/ __/
[23:34:13]  _/ // (7 7    // /  / / / _/
[23:34:13] /___/\___/_/|_/___/ /_/ /___/
[23:34:13]
[23:34:13] ver. 8.7.24#20210812-sha1:DEV
[23:34:13] 2021 Copyright(C) GridGain Systems, Inc. and Contributors
[23:34:13]
[23:34:13] Ignite documentation: http://gridgain.com
[23:34:13]
[23:34:13] Quiet mode.
[23:34:13]   ^-- Logging by 'JavaLogger [quiet=true, config=null]'
[23:34:13]   ^-- To see **FULL** console log here add -DIGNITE_QUIET=false or "-v" to ignite.{sh|bat}
[23:34:13]
[23:34:13] OS: Mac OS X 10.12.1 x86_64
[23:34:13] VM information: Java(TM) SE Runtime Environment 1.8.0_111-b14 Oracle Corporation Java HotSpot(TM) 64-Bit Server VM 25.111-b14
[23:34:13] Please set system property '-Djava.net.preferIPv4Stack=true' to avoid possible problems in mixed environments.
[23:34:13] Initial heap size is 128MB (should be no less than 512MB, use -Xms512m -Xmx512m).
[23:34:14] Configured plugins:
[23:34:14]   ^-- None
[23:34:14]
[23:34:14] Configured failure handler: [hnd=StopNodeOrHaltFailureHandler [tryStop=false, timeout=0, super=AbstractFailureHandler [ignoredFailureTypes=UnmodifiableSet [SYSTEM_WORKER_BLOCKED, SYSTEM_CRITICAL_OPERATION_TIMEOUT]]]]
[23:34:14] Message queue limit is set to 0 which may lead to potential OOMEs when running cache operations in FULL_ASYNC or PRIMARY_SYNC modes due to message queues growth on sender and receiver sides.
[23:34:15] Security status [authentication=off, tls/ssl=off]
[23:34:16] REST protocols do not start on client node. To start the protocols on client node set '-DIGNITE_REST_START_ON_CLIENT=true' system property.
[23:34:19] Performance suggestions for grid '服务网格专用部署' (fix if possible)
[23:34:19] To disable, set -DIGNITE_PERFORMANCE_SUGGESTIONS_DISABLED=true
[23:34:19]   ^-- Enable G1 Garbage Collector (add '-XX:+UseG1GC' to JVM options)
[23:34:19]   ^-- Specify JVM heap max size (add '-Xmx<size>[g|G|m|M|k|K]' to JVM options)
[23:34:19]   ^-- Set max direct memory size if getting 'OOME: Direct buffer memory' (add '-XX:MaxDirectMemorySize=<size>[g|G|m|M|k|K]' to JVM options)
[23:34:19]   ^-- Disable processing of calls to System.gc() (add '-XX:+DisableExplicitGC' to JVM options)
[23:34:19] Refer to this page for more performance suggestions: https://apacheignite.readme.io/docs/jvm-and-system-tuning
[23:34:19]
[23:34:19] To start Console Management & Monitoring run ignitevisorcmd.{sh|bat}
[23:34:19]
[23:34:19] Ignite node started OK (id=d3cf0f2c, instance name=服务网格专用部署)
[23:34:19] Topology snapshot [ver=14, locNode=d3cf0f2c, servers=1, clients=1, state=ACTIVE, CPUs=4, offheap=0.12GB, heap=3.6GB]
[23:34:19]   ^-- Baseline [id=0, size=1, online=1, offline=0]
=> #'core/ignite
(my-select/my-array-to-sql (my-select/token-to-sql ignite 1 (my-select/sql-to-ast (my-lexical/to-back "select count(1) from\n   (select distinct a.empno from agent_info a,staff_info b\n      where\n      (((c_rank_type='03' and mgrno=c_empno)\n      or a.empno=c_empno)\n      or ((c_rank_type='04' and chiefno=c_empno)\n      or a.empno=c_empno))\n      and ((a.end_date is null or a.end_date>p_sdate)\n      and a.start_date<p_edate+1)\n      and ((b.leave_reson_no not in('07','08','09','10','12')\n      and b.leave_date>p_sdate)\n      or b.leave_date is null)\n      and b.empno=a.empno\n      and substr(a.empno,1,4) not in('1EC0','1008')\n      and b.emp_name<>'AUTOUNDW'\n      union\n      select distinct a.empno from agent_info a,staff_info b\n      where (((c_rank_type='03' and mgrno=c_empno)\n      or a.empno=c_empno)\n      or ((c_rank_type='04' and chiefno=c_empno)\n      or a.empno=c_empno))\n      and ((a.end_date is null or a.end_date>p_sdate)\n      and a.start_date<p_edate+1)\n      and b.empno=a.empno\n      and substr(a.empno,1,4)\n      not in('1EC0','1008') and b.emp_name<>'AUTOUNDW'\n      and b.leave_reson_no in('07','08','09','10','12')\n      and b.leave_date>=add_months(p_sdate,1))"))))
=>
"select count(1) from (select distinct a.empno from agent_info a,staff_info b where (((c_rank_type='03' and mgrno=c_empno) or a.empno=c_empno) or ((c_rank_type='04' and chiefno=c_empno) or a.empno=c_empno)) and ((a.end_date is or a.end_date>p_sdate) and a.start_date<p_edate+1) and ((b.leave_reson_no not in ('07','08','09','10','12') and b.leave_date>p_sdate) or b.leave_date is) and b.empno=a.empno and substr(a.empno,1,4) not in ('1EC0','1008') and b.emp_name<>'AUTOUNDW' union select distinct a.empno from agent_info a,staff_info b where (((c_rank_type='03' and mgrno=c_empno) or a.empno=c_empno) or ((c_rank_type='04' and chiefno=c_empno) or a.empno=c_empno)) and ((a.end_date is or a.end_date>p_sdate) and a.start_date<p_edate+1) and b.empno=a.empno and substr(a.empno,1,4) not in ('1EC0','1008') and b.emp_name<>'AUTOUNDW' and b.leave_reson_no in ('07','08','09','10','12') and b.leave_date>=add_months(p_sdate,1))"
